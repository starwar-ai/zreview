<!--pages/index/index.wxml-->
<view class="index-container">
  <!-- Search Bar -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <icon class="search-icon" type="search" size="16" color="#999"></icon>
      <input 
        class="search-input" 
        type="text" 
        placeholder="æœç´¢å®¡æ‰¹å•å·ã€ç”³è¯·äºº..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
      />
      <icon wx:if="{{searchKeyword}}" class="clear-icon" type="clear" size="16" bindtap="clearSearch"></icon>
    </view>
    <view class="filter-btn" bindtap="toggleFilter">
      <icon type="download" size="16" color="#667eea"></icon>
      <text>ç­›é€‰</text>
    </view>
  </view>

  <!-- Filter Panel -->
  <view class="filter-panel {{showFilter ? 'show' : ''}}">
    <view class="filter-row">
      <text class="filter-label">ç”³è¯·äºº:</text>
      <input class="filter-input" placeholder="è¯·è¾“å…¥ç”³è¯·äºº" value="{{filterOptions.applicant}}" data-field="applicant" bindinput="onFilterChange" />
    </view>
    <view class="filter-row">
      <text class="filter-label">å¼€å§‹æ—¥æœŸ:</text>
      <picker mode="date" value="{{filterOptions.startDate}}" data-field="startDate" bindchange="onFilterChange">
        <view class="filter-input">{{filterOptions.startDate || 'è¯·é€‰æ‹©'}}</view>
      </picker>
    </view>
    <view class="filter-row">
      <text class="filter-label">ç»“æŸæ—¥æœŸ:</text>
      <picker mode="date" value="{{filterOptions.endDate}}" data-field="endDate" bindchange="onFilterChange">
        <view class="filter-input">{{filterOptions.endDate || 'è¯·é€‰æ‹©'}}</view>
      </picker>
    </view>
    <view class="filter-actions">
      <button class="filter-btn-reset" bindtap="resetFilter">é‡ç½®</button>
      <button class="filter-btn-apply" bindtap="applyFilter">åº”ç”¨</button>
    </view>
  </view>

  <!-- Tabs -->
  <view class="tabs">
    <view
      wx:for="{{tabs}}"
      wx:key="value"
      class="tab-item {{activeTab === item.value ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="{{item.value}}"
    >
      <text class="tab-label">{{item.label}}</text>
      <view wx:if="{{item.count > 0}}" class="tab-badge">{{item.count}}</view>
    </view>
  </view>

  <!-- Type Filter -->
  <view class="filter-bar">
    <view class="filter-label">ç±»å‹:</view>
    <scroll-view class="filter-scroll" scroll-x>
      <view class="filter-options">
        <view
          class="filter-item {{currentType === '' ? 'active' : ''}}"
          bindtap="filterByType"
          data-type=""
        >
          å…¨éƒ¨
        </view>
        <view
          wx:for="{{typeOptions}}"
          wx:key="value"
          class="filter-item {{currentType === item.value ? 'active' : ''}}"
          bindtap="filterByType"
          data-type="{{item.value}}"
        >
          <text class="type-icon">{{item.icon}}</text>
          <text>{{item.label}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- Loading State -->
  <view wx:if="{{loading && !displayList.length}}" class="loading-state">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- List -->
  <scroll-view
    wx:else
    class="list-scroll"
    scroll-y
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    bindscrolltolower="onLoadMore"
    lower-threshold="100"
  >
    <view wx:if="{{displayList.length > 0}}" class="list-content">
      <view
        wx:for="{{displayList}}"
        wx:key="id"
        class="approval-card {{item.isOverdue ? 'overdue' : ''}}"
        bindtap="goToDetail"
        data-id="{{item.id}}"
      >
        <!-- Header -->
        <view class="card-header">
          <view class="type-badge" style="background: {{item.typeColor}}">
            <text class="type-icon">{{item.typeIcon}}</text>
            <text>{{item.typeName}}</text>
          </view>
          <view class="status-badge {{item.status}}" style="color: {{item.statusColor}}">
            {{item.statusText}}
          </view>
        </view>

        <!-- ID -->
        <view class="card-id">
          <text class="id-label">å•å·:</text>
          <text class="id-value">{{item.id}}</text>
        </view>

        <!-- Summary -->
        <view class="card-summary">{{item.summary}}</view>

        <!-- Fields -->
        <view class="card-fields">
          <view wx:for="{{item.displayFields}}" wx:key="key" wx:for-item="field" class="field-row">
            <text class="field-label">{{field.label}}:</text>
            <text class="field-value">{{field.value}}</text>
          </view>
        </view>

        <!-- Footer -->
        <view class="card-footer">
          <view class="footer-left">
            <text class="applicant">{{item.applicant}}</text>
          </view>
          <view class="footer-right">
            <text class="time">{{item.submitTime}}</text>
            <view wx:if="{{item.isOverdue}}" class="overdue-tag">è¶…æ—¶</view>
          </view>
        </view>
      </view>

      <!-- Load More -->
      <view wx:if="{{hasMore && !loading}}" class="load-more" bindtap="onLoadMore">
        <text>ç‚¹å‡»åŠ è½½æ›´å¤š</text>
      </view>
      <view wx:if="{{loading}}" class="load-more loading">
        <view class="loading-spinner small"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && displayList.length > 0}}" class="no-more">
        <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
      </view>
    </view>

    <!-- Empty State -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">æš‚æ— å®¡æ‰¹æ•°æ®</view>
      <view class="empty-tip">ä¸‹æ‹‰åˆ·æ–°è¯•è¯•</view>
    </view>
  </scroll-view>
</view>
